<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CV Scanner — OpenAI Feedback</title>
  <style>
    /* Simple clean styles - feel free to change */
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin:0; padding:20px; background:#f5f7fb; color:#0b1220;}
    .wrap { max-width:1000px; margin:0 auto; background:white; border-radius:12px; padding:20px; box-shadow:0 6px 30px rgba(15,23,42,0.08);}
    h1 { margin:0 0 10px 0; font-size:22px;}
    textarea { width:100%; resize:vertical; min-height:250px; padding:12px; border-radius:8px; border:1px solid #e6e9ef; font-family:inherit; font-size:14px;}
    .row { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; align-items:center; }
    button { padding:10px 14px; border-radius:8px; border:0; cursor:pointer; background:#0b5cff; color:white; font-weight:600; }
    .muted { color:#6b7280; font-size:13px; }
    .result { margin-top:14px; padding:12px; border-radius:8px; background:#f8fafc; border:1px solid #eef2ff;}
    .score { font-size:34px; font-weight:700;}
    .breakdown { font-family:monospace; font-size:13px; white-space:pre-wrap; margin-top:8px; }
    input[type=file] { display:inline-block; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>CV Scanner — OpenAI Feedback</h1>
    <p class="muted">Paste your CV text below (or upload a .txt). The site will call a secure serverless function which uses OpenAI to generate feedback and improved bullet suggestions.</p>

    <label><strong>Paste CV text</strong></label>
    <textarea id="cvText" placeholder="Paste CV content here..."></textarea>

    <div class="row">
      <input id="fileInput" type="file" accept=".txt,.md,.csv" />
      <button id="analyzeBtn">Get OpenAI feedback</button>
      <button id="clearBtn" style="background:#e5e7eb;color:#0b1220">Clear</button>
      <div style="margin-left:auto" class="muted">No key in repo — uses serverless function</div>
    </div>

    <div id="result" class="result" style="display:none;">
      <div><strong>Score</strong>: <span id="score">—</span>/100</div>
      <div id="summary" style="margin-top:8px;"></div>
      <div class="breakdown" id="feedback"></div>
    </div>

    <div id="loading" style="display:none;margin-top:12px" class="muted">Calling OpenAI and analysing... this may take a few seconds.</div>
  </div>

  <script>
    // Minimal frontend logic
    const analyzeBtn = document.getElementById('analyzeBtn');
    const clearBtn = document.getElementById('clearBtn');
    const fileInput = document.getElementById('fileInput');
    const cvText = document.getElementById('cvText');
    const result = document.getElementById('result');
    const scoreEl = document.getElementById('score');
    const summaryEl = document.getElementById('summary');
    const feedbackEl = document.getElementById('feedback');
    const loading = document.getElementById('loading');

    fileInput.addEventListener('change', async (ev) => {
      const f = ev.target.files[0];
      if (!f) return;
      const text = await f.text();
      cvText.value = text;
    });

    clearBtn.addEventListener('click', () => {
      cvText.value = '';
      result.style.display = 'none';
    });

    analyzeBtn.addEventListener('click', async () => {
      const text = cvText.value.trim();
      if (!text) { alert('Paste or upload a CV first.'); return; }

      // show loading
      loading.style.display = 'block';
      result.style.display = 'none';
      scoreEl.textContent = '—';
      summaryEl.textContent = '';
      feedbackEl.textContent = '';

      try {
        // Call serverless function at /api/openai (Vercel) or /.netlify/functions/openai for Netlify
        const endpoint = '/api/openai'; // if you deploy to Netlify change to '/.netlify/functions/openai'
        const res = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text })
        });
        if (!res.ok) {
          const errText = await res.text();
          throw new Error(errText || 'Server error');
        }
        const j = await res.json();
        // Expected shape: { score: number, summary: string, feedback: string[] , raw: string }
        scoreEl.textContent = j.score ?? '—';
        summaryEl.textContent = j.summary ? 'Suggested profile summary: ' + j.summary : '';
        // feedback array -> join
        feedbackEl.textContent = (j.feedback && j.feedback.length) ? ('• ' + j.feedback.join('\n\n• ')) : (j.raw || 'No feedback returned.');
        result.style.display = 'block';
      } catch (e) {
        alert('Error: ' + (e.message || e));
      } finally {
        loading.style.display = 'none';
      }
    });
  </script>
</body>
</html>
